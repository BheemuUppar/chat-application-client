<div *ngIf="currentPage == undefined">
    <header>
        <div class="d-flex justify-content-between align-items-center  py-1">
            <div class="d-flex align-items-center gap-2 px-3">

                <div class="profile_img " [ngClass]="userSevrice.isOnline(user.user_id)  ? 'online' : 'offline' "><img
                        [src]="user?.profile_path" appDefaultImage alt=""></div>
                <h3 class="m-0 fs-5 fw-bold ">{{user.name}}</h3>
                <!-- <small>{{user.email}}</small> -->
            </div>
            <div class="d-flex align-items-center gap-3">
                <div class="new_chat " matTooltip="New chat" (click)="goTo('newChat')">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor"
                        viewBox="0 0 576 512"><!--!Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.-->
                        <path
                            d="M284 224.8a34.1 34.1 0 1 0 34.3 34.1A34.2 34.2 0 0 0 284 224.8zm-110.5 0a34.1 34.1 0 1 0 34.3 34.1A34.2 34.2 0 0 0 173.6 224.8zm220.9 0a34.1 34.1 0 1 0 34.3 34.1A34.2 34.2 0 0 0 394.5 224.8zm153.8-55.3c-15.5-24.2-37.3-45.6-64.7-63.6-52.9-34.8-122.4-54-195.7-54a406 406 0 0 0 -72 6.4 238.5 238.5 0 0 0 -49.5-36.6C99.7-11.7 40.9 .7 11.1 11.4A14.3 14.3 0 0 0 5.6 34.8C26.5 56.5 61.2 99.3 52.7 138.3c-33.1 33.9-51.1 74.8-51.1 117.3 0 43.4 18 84.2 51.1 118.1 8.5 39-26.2 81.8-47.1 103.5a14.3 14.3 0 0 0 5.6 23.3c29.7 10.7 88.5 23.1 155.3-10.2a238.7 238.7 0 0 0 49.5-36.6A406 406 0 0 0 288 460.1c73.3 0 142.8-19.2 195.7-54 27.4-18 49.1-39.4 64.7-63.6 17.3-26.9 26.1-55.9 26.1-86.1C574.4 225.4 565.6 196.4 548.3 169.5zM285 409.9a345.7 345.7 0 0 1 -89.4-11.5l-20.1 19.4a184.4 184.4 0 0 1 -37.1 27.6 145.8 145.8 0 0 1 -52.5 14.9c1-1.8 1.9-3.6 2.8-5.4q30.3-55.7 16.3-100.1c-33-26-52.8-59.2-52.8-95.4 0-83.1 104.3-150.5 232.8-150.5s232.9 67.4 232.9 150.5C517.9 342.5 413.6 409.9 285 409.9z" />
                    </svg>
                </div>
                <!-- <div class="menu">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor"
                        viewBox="0 0 128 512">
                        <path
                            d="M64 360a56 56 0 1 0 0 112 56 56 0 1 0 0-112zm0-160a56 56 0 1 0 0 112 56 56 0 1 0 0-112zM120 96A56 56 0 1 0 8 96a56 56 0 1 0 112 0z" />
                    </svg>
                </div> -->
                <div style="position: relative;">
                    <button mat-icon-button [matMenuTriggerFor]="menu">
                        <mat-icon>more_vert</mat-icon>
                    </button>
                    <mat-menu #menu="matMenu">


                        <button mat-menu-item (click)="goTo('newGroup')">
                            <!-- <mat-icon>Group</mat-icon> -->
                            <span>New group</span>
                        </button>
                        <button mat-menu-item (click)="logout()">
                            <!-- <mat-icon>Logout</mat-icon> -->
                            <span>Logout</span>
                        </button>

                    </mat-menu>
                </div>

            </div>
        </div>

    </header>

    <div class="search-wrapper">

        <div class="d-flex px-3 py-1 align-items-center">
            <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor"
                viewBox="0 0 512 512"><!--!Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.-->
                <path
                    d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352a144 144 0 1 0 0-288 144 144 0 1 0 0 288z" />
            </svg>
            <input type="text" name="filterChat" class="search_input w-100" id="search" placeholder="Search">

        </div>

    </div>

    <div class="chat_list_wrapper pe-2">
        <ul class="list-unstyled chat_list" *ngIf="myChatUsers.length>0">
            <li class="chat_contact  px-3 d-flex"
                [ngClass]="{'active':currentChat &&   ( user.contact_id == currentChat.contact_id)}"
                *ngFor="let user of myChatUsers" (click)="setCurrentChat(user)">
                <mat-checkbox *ngIf="isSelectionMode" class="example-margin"
                    (change)="onSelection($event, user.contact_id)"
                    [checked]="selectedUsers.includes(user.contact_id)"></mat-checkbox>
                <div class="d-flex align-items-center w-100">
                    <div class="profile_img " [ngClass]="getOnlineStatusClass(user)">
                        <img [src]="user.profile_path" appDefaultImage alt="">
                    </div>
                    <div class="name ms-3">
                        <h6 class=" m-0 ">{{user.contact_name}}</h6>
                        <!-- <div class="typing">
                            <span></span>
                            <span></span>
                            <span></span>
                        </div> -->
                        <small class="last_msg" *ngIf="user.last_message">{{user.sender_id == userSevrice.user.user_id ?
                            'You : '+ user.last_message : user.last_message }}</small>
                        <small class="last_msg" *ngIf="!user.last_message && user.message_file == null"><b
                                style="font-style: italic;">No Messages</b></small>
                        <small class="last_msg" *ngIf="user.message_file ">
                            {{user.sender_id == userSevrice.user.user_id ?
                            'You : '+ 'Sent a file' : ' Received a file' }}
                        </small>


                    </div>
                    <div class="status flex-grow-1">
                        <small>{{dateService.formatDate(user.last_message_time)}}</small>
                        <small class="unread_count" style="background-color: green;"
                            *ngIf="user.unread_count != 0">{{user.unread_count}}</small>
                    </div>
                </div>
            </li>


        </ul>

        <p *ngIf="myChatUsers.length == 0">No chats</p>

    </div>
</div>

<div id="newChat" *ngIf="currentPage == 'newChat'">
    <nav>
        <div class="d-flex">
            <button (click)="goTo(undefined)" class="btn-transparent">
                <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 448 512">
                    <path
                        d="M9.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.2 288 416 288c17.7 0 32-14.3 32-32s-14.3-32-32-32l-306.7 0L214.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z" />
                </svg>
            </button>
            <h5>New chat</h5>
        </div>
        <div class="search_users">
            <input type="text" [(ngModel)]="searchText" (input)="fetchUsers()" name="newUserSearch"
                placeholder="Search name or email">
        </div>
        <ul *ngIf="users" class=" list-unstyled px-0 mt-4">
            <ng-container *ngFor="let user of users">
                <li class=" d-flex chat_contact" (click)="startChat(user)" style="cursor: pointer;">
                    <div class="profile_img">
                        <img [src]="user.profile_path" appDefaultImage alt="">
                    </div>
                    <div class=" ms-3 bg-transparent">
                        <h6 class=" m-0 ">{{user.contact_name}}</h6>
                        <small>{{user.email}}</small>
                    </div>

                </li>
            </ng-container>

            <li *ngIf="users?.length === 0">No users found with {{searchText}}</li>
        </ul>
    </nav>
</div>

<div id="newGroup" *ngIf="currentPage == 'newGroup'">
    <nav>
        <div class="d-flex">
            <button (click)="goTo(undefined)" class="btn-transparent">
                <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 448 512">
                    <!--!Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.-->
                    <path
                        d="M9.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.2 288 416 288c17.7 0 32-14.3 32-32s-14.3-32-32-32l-306.7 0L214.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z" />
                </svg>

            </button>
            <h5>Create Group</h5>

        </div>
    </nav>
    <div class="search_users">
        <input type="text" [(ngModel)]="searchTextForGroup" name="newUserSearch" placeholder="Search name or email">
    </div>
    <div class="chat_list_wrapper  mt-4">
        <ul class="list-unstyled chat_list" *ngIf="myChatUsers.length>0">
            <ng-container *ngFor="let user of myChatUsers ">
                <li class="chat_contact  px-3 d-flex" *ngIf="user.isgroup == false">
                    <mat-checkbox class="example-margin" (change)="onSelection($event, user.contact_id)"
                        [checked]="selectedUsers.includes(user.contact_id)"></mat-checkbox>
                    <div class="d-flex align-items-center">
                        <div class="profile_img "
                            [ngClass]="userSevrice.isOnline(user.contact_id) && user.isgroup == true  ? 'online' : user.isgroup == false ?  'offline' : ''">
                            <img [src]="user.profile_path" appDefaultImage alt="">
                        </div>
                        <div class="name ms-3">
                            <h6 class=" m-0 ">{{user.contact_name}}</h6>
                            <!-- <div class="typing">
                        <span></span>
                        <span></span>
                        <span></span>
                    </div> -->
                            <small class="last_msg" *ngIf="user.last_message">{{user.sender_id ==
                                userSevrice.user.user_id ?
                                'You : '+ user.last_message :user.last_message }}</small>
                            <small class="last_msg" *ngIf="!user.last_message"><b style="font-style: italic;">No
                                    Messages</b></small>

                        </div>
                        <div class="status flex-grow-1">
                            <small>{{dateService.formatDate(user.last_message_time)}}</small>
                            <small class="unread_count" style="background-color: green;"
                                *ngIf="user.unread_count != 0">{{user.unread_count}}</small>
                        </div>
                    </div>
                </li>
            </ng-container>

            <!--  -->
            <!-- <li class="chat_contact  px-3">
                <div class="d-flex align-items-center">
                    <div class="profile_img offline">
                        <img src="" appDefaultImage alt="">
                    </div>
                    <div class="name ms-3">
                        <h6 class=" m-0 ">Md yusuf</h6>
                        
                        <small class="last_msg">Good Night</small>
                    </div>
                    <div class="status flex-grow-1">
                        <small>Now</small>
    
                    </div>
                </div>
            </li> -->

            <!--  -->

        </ul>

        <p *ngIf="myChatUsers.length == 0">No chats</p>

    </div>

    <div >
        <!-- <button mat-button color="primary" class="float-end" (click)="next()">Next</button> -->
        <button  class="float-end btn-transparent" matTooltip="Next" (click)="next()">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" fill="currentColor">
                <path d="M502.6 278.6c12.5-12.5 12.5-32.8 0-45.3l-128-128c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L402.7 224 32 224c-17.7 0-32 14.3-32 32s14.3 32 32 32l370.7 0-73.4 73.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0l128-128z"/>
            </svg>
        </button>
    </div>

</div>
<div id="saveGroupInfo" class="p-4" *ngIf="currentPage == 'saveGroupInfo'">
    <nav>
        <div class="d-flex">
            <button (click)="goTo('newGroup')" class="btn-transparent">
                <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 448 512">
                    <!--!Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.-->
                    <path
                        d="M9.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.2 288 416 288c17.7 0 32-14.3 32-32s-14.3-32-32-32l-306.7 0L214.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z" />
                </svg>
            </button>
            <h5>Create Group</h5>

        </div>
    </nav>
    <div class="groupProfile">
        <div class="image-wrapper">
            <img [src]="groupImage" appDefaultImage alt="Group profile" height="70" width="70">
            <input type="file" name="group_profile" accept="image/png" id="group_profile" #fileInput
                (change)="onGroupProfileUpload($event)" hidden>
            <div class="overlay"></div>
            <div class="hover-icon">
               <button class="btn-sm btn" (click)="triggerFileInput()" >
                    <svg xmlns="http://www.w3.org/2000/svg" height="24" width="24" fill="#000">
                        <path
                            d="M12 16.3q1.375 0 2.338-.962.962-.963.962-2.338 0-1.375-.962-2.337Q13.375 9.7 12 9.7t-2.338.963q-.962.962-.962 2.337 0 1.375.962 2.338.963.962 2.338.962Zm-6 3.7q-.825 0-1.413-.588Q4 18.825 4 18V8q0-.825.587-1.413Q5.175 6 6 6h2.1l.6-1.3q.15-.325.45-.513.3-.187.65-.187h5.4q.35 0 .65.187.3.188.45.513l.6 1.3H18q.825 0 1.413.587Q20 7.175 20 8v10q0 .825-.587 1.412-.588.588-1.413.588Zm6-6.25q-2 0-3.375-1.375T7.25 9q0-2 1.375-3.375T12 4.25q2 0 3.375 1.375T16.75 9q0 2-1.375 3.375T12 13.75ZM6 18h12V8H6v10ZM12 9Zm0 4.25Z" />
                    </svg>
                </button>
             
            </div>
        </div>
        <div class="search_users">
            <input type="text" placeholder="Group Name" [(ngModel)]="groupName">
        </div>
    </div>
    

    <div>
        <button  class="float-end btn-transparent" matTooltip="Create group" (click)="createGroup()">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" fill="currentColor">
                <path d="M502.6 278.6c12.5-12.5 12.5-32.8 0-45.3l-128-128c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L402.7 224 32 224c-17.7 0-32 14.3-32 32s14.3 32 32 32l370.7 0-73.4 73.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0l128-128z"/>
            </svg>
        </button>
        

    </div>

</div>